{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport axios from \"axios\";\nimport jwt_decode from \"jwt-decode\";\nimport dayjs from \"dayjs\";\nimport { useContext } from \"react\";\nimport AuthContext from \"../context/AuthContext\";\nconst baseURL = \"http://localhost:8000/api\";\nconst controller = new AbortController();\n\nconst useAxios = () => {\n  _s();\n\n  const {\n    authTokens,\n    setUser,\n    setAuthTokens,\n    logoutUser\n  } = useContext(AuthContext);\n  let err = \"\";\n  const axiosInstance = axios.create({\n    baseURL,\n    headers: {\n      Authorization: `Bearer ${authTokens === null || authTokens === void 0 ? void 0 : authTokens.access}`\n    }\n  });\n  axiosInstance.interceptors.request.use(async req => {\n    const user = jwt_decode(authTokens.access);\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\n\n    if (!isExpired) {\n      return req;\n    }\n\n    const response = await axios.post(`${baseURL}/token/refresh/`, {\n      signal: controller.signal,\n      refresh: authTokens.refresh\n    }).catch(error => err = error.response.status);\n\n    if (response.data && err === \"\") {\n      localStorage.setItem(\"authTokens\", JSON.stringify(response.data));\n      setAuthTokens(response.data);\n      setUser(jwt_decode(response.data.access));\n      req.headers.Authorization = `Bearer ${response.data.access}`;\n      return req;\n    } else {\n      controller.abort();\n      localStorage.removeItem(\"authTokens\");\n    }\n  });\n  return axiosInstance;\n};\n\n_s(useAxios, \"5CUJL62p71kIVusF/sQvDYZvz1E=\");\n\nexport default useAxios;","map":{"version":3,"names":["axios","jwt_decode","dayjs","useContext","AuthContext","baseURL","controller","AbortController","useAxios","authTokens","setUser","setAuthTokens","logoutUser","err","axiosInstance","create","headers","Authorization","access","interceptors","request","use","req","user","isExpired","unix","exp","diff","response","post","signal","refresh","catch","error","status","data","localStorage","setItem","JSON","stringify","abort","removeItem"],"sources":["C:/Users/Pablo/dae_api/src/utils/useAxios.jsx"],"sourcesContent":["import axios from \"axios\";\r\nimport jwt_decode from \"jwt-decode\";\r\nimport dayjs from \"dayjs\";\r\nimport { useContext } from \"react\";\r\nimport AuthContext from \"../context/AuthContext\";\r\n\r\nconst baseURL = \"http://localhost:8000/api\";\r\nconst controller = new AbortController();\r\nconst useAxios = () => {\r\n  const { authTokens, setUser, setAuthTokens, logoutUser } = useContext(AuthContext);\r\n  let err = \"\"\r\n\r\n  const axiosInstance = axios.create({\r\n    baseURL,\r\n    headers: { Authorization: `Bearer ${authTokens?.access}` }\r\n  });\r\n\r\n  axiosInstance.interceptors.request.use(async req => {\r\n    const user = jwt_decode(authTokens.access);\r\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\r\n\r\n    if (!isExpired){\r\n      return req;\r\n    }\r\n    \r\n\r\n    const response = await axios.post(`${baseURL}/token/refresh/`, {\r\n      signal: controller.signal,\r\n      refresh: authTokens.refresh\r\n    \r\n    }).catch(error => err = error.response.status);\r\n    \r\n\r\n    \r\n    if(response.data && err === \"\"){\r\n      localStorage.setItem(\"authTokens\", JSON.stringify(response.data));\r\n\r\n      setAuthTokens(response.data);\r\n      setUser(jwt_decode(response.data.access));\r\n  \r\n      req.headers.Authorization = `Bearer ${response.data.access}`;\r\n      return req;\r\n\r\n    }else{\r\n      controller.abort()\r\n      localStorage.removeItem(\"authTokens\")\r\n    }\r\n   \r\n\r\n  });\r\n\r\n  return axiosInstance;\r\n};\r\n\r\nexport default useAxios;"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,UAAT,QAA2B,OAA3B;AACA,OAAOC,WAAP,MAAwB,wBAAxB;AAEA,MAAMC,OAAO,GAAG,2BAAhB;AACA,MAAMC,UAAU,GAAG,IAAIC,eAAJ,EAAnB;;AACA,MAAMC,QAAQ,GAAG,MAAM;EAAA;;EACrB,MAAM;IAAEC,UAAF;IAAcC,OAAd;IAAuBC,aAAvB;IAAsCC;EAAtC,IAAqDT,UAAU,CAACC,WAAD,CAArE;EACA,IAAIS,GAAG,GAAG,EAAV;EAEA,MAAMC,aAAa,GAAGd,KAAK,CAACe,MAAN,CAAa;IACjCV,OADiC;IAEjCW,OAAO,EAAE;MAAEC,aAAa,EAAG,UAASR,UAAV,aAAUA,UAAV,uBAAUA,UAAU,CAAES,MAAO;IAA9C;EAFwB,CAAb,CAAtB;EAKAJ,aAAa,CAACK,YAAd,CAA2BC,OAA3B,CAAmCC,GAAnC,CAAuC,MAAMC,GAAN,IAAa;IAClD,MAAMC,IAAI,GAAGtB,UAAU,CAACQ,UAAU,CAACS,MAAZ,CAAvB;IACA,MAAMM,SAAS,GAAGtB,KAAK,CAACuB,IAAN,CAAWF,IAAI,CAACG,GAAhB,EAAqBC,IAArB,CAA0BzB,KAAK,EAA/B,IAAqC,CAAvD;;IAEA,IAAI,CAACsB,SAAL,EAAe;MACb,OAAOF,GAAP;IACD;;IAGD,MAAMM,QAAQ,GAAG,MAAM5B,KAAK,CAAC6B,IAAN,CAAY,GAAExB,OAAQ,iBAAtB,EAAwC;MAC7DyB,MAAM,EAAExB,UAAU,CAACwB,MAD0C;MAE7DC,OAAO,EAAEtB,UAAU,CAACsB;IAFyC,CAAxC,EAIpBC,KAJoB,CAIdC,KAAK,IAAIpB,GAAG,GAAGoB,KAAK,CAACL,QAAN,CAAeM,MAJhB,CAAvB;;IAQA,IAAGN,QAAQ,CAACO,IAAT,IAAiBtB,GAAG,KAAK,EAA5B,EAA+B;MAC7BuB,YAAY,CAACC,OAAb,CAAqB,YAArB,EAAmCC,IAAI,CAACC,SAAL,CAAeX,QAAQ,CAACO,IAAxB,CAAnC;MAEAxB,aAAa,CAACiB,QAAQ,CAACO,IAAV,CAAb;MACAzB,OAAO,CAACT,UAAU,CAAC2B,QAAQ,CAACO,IAAT,CAAcjB,MAAf,CAAX,CAAP;MAEAI,GAAG,CAACN,OAAJ,CAAYC,aAAZ,GAA6B,UAASW,QAAQ,CAACO,IAAT,CAAcjB,MAAO,EAA3D;MACA,OAAOI,GAAP;IAED,CATD,MASK;MACHhB,UAAU,CAACkC,KAAX;MACAJ,YAAY,CAACK,UAAb,CAAwB,YAAxB;IACD;EAGF,CAhCD;EAkCA,OAAO3B,aAAP;AACD,CA5CD;;GAAMN,Q;;AA8CN,eAAeA,QAAf"},"metadata":{},"sourceType":"module"}